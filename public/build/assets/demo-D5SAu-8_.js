import{w as V,o as Y,a as f,b as m,d as j,e as z,f as e,g as R,v as J,h as x,F as S,r as D,t as p,n as C,i as _,j as B,k as g,l as I,m as G,p as M,q as Q,s as O,c as X,_ as Z}from"./SettingsPage-TikLQTnd.js";const ee={class:"grid grid-cols-1 gap-6 xl:grid-cols-[minmax(0,1fr)_280px]"},te={class:"space-y-4"},se={class:"flex flex-wrap items-center justify-between gap-3"},ae={class:"inline-flex items-center gap-2"},oe=["href"],le={class:"mb-2 flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-slate-500"},ne={class:"mb-2 text-sm font-semibold text-slate-800"},re={class:"mb-2 inline-flex items-center gap-1"},ie={class:"ml-2 text-xs font-semibold text-slate-600"},de={class:"line-clamp-3 text-sm leading-6 text-slate-600"},ce={key:0,class:"rounded-xl border border-slate-200 bg-white p-6 text-sm text-slate-500"},me={key:1,class:"rounded-xl border border-slate-200 bg-white p-6 text-sm text-slate-500"},ue={class:"flex items-center justify-between rounded-xl border border-slate-200 bg-white p-3"},pe=["disabled"],xe={class:"text-sm text-slate-500"},ve=["disabled"],ge={class:"h-fit rounded-xl border border-slate-200 bg-white p-5 shadow-sm"},he={class:"mb-2 flex items-end gap-2"},be={class:"text-5xl font-semibold leading-none text-slate-800"},fe={class:"mb-3 inline-flex items-center gap-1"},we={class:"text-sm text-slate-500"},ye={key:0,class:"mt-6 overflow-hidden rounded-xl border border-slate-200 bg-white p-4 shadow-sm"},_e=["src"],T=5,ke={__name:"ReviewsPage",setup(s){const t=g([]),o=g("default"),n=g(1),l=g(0),v=g(0),h=g(!1),r=g(""),w=I(()=>Math.max(1,Math.ceil(l.value/T))),U=I(()=>t.value),y=I(()=>Number(v.value||0).toFixed(1)),a=b=>new Date(b).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"}),d=()=>{n.value<w.value&&(n.value+=1)},A=()=>{n.value>1&&(n.value-=1)},k=async()=>{var b,i,u,$;h.value=!0;try{const{data:c}=await f.get("/api/reviews",{params:{page:n.value,per_page:T,sort:o.value}});t.value=Array.isArray(c==null?void 0:c.data)?c.data:[],l.value=Number(((b=c==null?void 0:c.meta)==null?void 0:b.total)||t.value.length||0),v.value=Number(((i=c==null?void 0:c.meta)==null?void 0:i.average_rating)||0);const H=Number(((u=c==null?void 0:c.meta)==null?void 0:u.page)||n.value),K=Number((($=c==null?void 0:c.meta)==null?void 0:$.last_page)||w.value);n.value=Math.min(H,Math.max(1,K))}catch{t.value=[],l.value=0,v.value=0}finally{h.value=!1}};return V(o,async()=>{n.value=1,await k()}),V(n,async()=>{await k()}),Y(()=>{k(),f.get("/api/settings").then(({data:b})=>{r.value=(b==null?void 0:b.yandex_widget_url)||""}).catch(()=>{r.value=""})}),(b,i)=>(m(),j(B,{active:"reviews",title:"Отзывы"},{default:z(()=>[e("div",ee,[e("div",te,[e("div",se,[i[3]||(i[3]=e("div",{class:"inline-flex items-center rounded-md border border-slate-200 bg-white px-3 py-1 text-xs text-slate-500"}," Яндекс Карты ",-1)),e("div",ae,[i[2]||(i[2]=e("label",{class:"text-xs text-slate-500",for:"sort-order"},"Сортировка",-1)),R(e("select",{id:"sort-order","onUpdate:modelValue":i[0]||(i[0]=u=>o.value=u),class:"h-9 rounded-md border border-slate-300 bg-white px-2 text-sm text-slate-700"},[...i[1]||(i[1]=[e("option",{value:"default"},"По умолчанию",-1),e("option",{value:"newest"},"По новизне",-1),e("option",{value:"negative"},"Сначала отрицательные",-1),e("option",{value:"positive"},"Сначала положительные",-1)])],512),[[J,o.value]])])]),(m(!0),x(S,null,D(U.value,u=>(m(),x("a",{key:u.id,href:`/demo.html?page=review&id=${u.id}`,class:"block rounded-xl border border-slate-200 bg-white p-4 shadow-sm transition hover:border-sky-300"},[e("div",le,[e("span",null,p(a(u.date)),1),i[4]||(i[4]=e("span",null,"Филиал 1",-1))]),e("div",ne,p(u.author),1),e("div",re,[(m(),x(S,null,D(5,$=>e("span",{key:$,class:C(["text-sm",$<=u.rating?"text-amber-400":"text-slate-300"])},"★",2)),64)),e("span",ie,p(u.rating)+".0",1)]),e("p",de,p(u.text),1)],8,oe))),128)),!h.value&&U.value.length===0?(m(),x("div",ce," Отзывы не найдены. Выполните импорт из Яндекс.Карт на странице настроек. ")):_("",!0),h.value?(m(),x("div",me," Загрузка отзывов... ")):_("",!0),e("div",ue,[e("button",{type:"button",class:"rounded-md border border-slate-300 px-3 py-1 text-sm text-slate-700 disabled:opacity-50",disabled:n.value===1,onClick:A}," Назад ",8,pe),e("div",xe," Страница "+p(n.value)+" из "+p(w.value),1),e("button",{type:"button",class:"rounded-md border border-slate-300 px-3 py-1 text-sm text-slate-700 disabled:opacity-50",disabled:n.value===w.value,onClick:d}," Вперёд ",8,ve)])]),e("aside",ge,[e("div",he,[e("span",be,p(y.value),1),i[5]||(i[5]=e("span",{class:"pb-1 text-sm text-slate-500"},"из 5",-1))]),e("div",fe,[(m(),x(S,null,D(5,u=>e("span",{key:`avg-${u}`,class:C(["text-xl",u<=Math.round(y.value)?"text-amber-400":"text-slate-300"])},"★",2)),64))]),e("div",we," Всего отзывов: "+p(l.value),1)])]),r.value?(m(),x("section",ye,[i[6]||(i[6]=e("div",{class:"mb-3 text-sm font-semibold text-slate-800"}," Виджет отзывов Яндекс ",-1)),e("iframe",{src:r.value,class:"h-[620px] w-full rounded-md border border-slate-200",loading:"lazy",referrerpolicy:"no-referrer-when-downgrade"},null,8,_e)])):_("",!0)]),_:1}))}},$e=(s,t)=>{const o=s.__vccOpts||s;for(const[n,l]of t)o[n]=l;return o},P={id:1,author:"—",rating:0,date:new Date().toISOString().slice(0,10),text:"",reply:""},Re={components:{AppFrame:B},data(){return{reply:"",saved:!1,review:P,reviewId:1}},async mounted(){const s=new URLSearchParams(window.location.search),t=Number(s.get("id")||1);this.reviewId=t;try{const{data:o}=await f.get(`/api/reviews/${t}`);this.review=o||P,this.reply=(o==null?void 0:o.reply)||""}catch{this.review=P,this.reply=""}},methods:{async setRating(s){try{const{data:t}=await f.patch(`/api/reviews/${this.reviewId}`,{rating:s});this.review=(t==null?void 0:t.review)||this.review,this.saved=!0,setTimeout(()=>{this.saved=!1},900)}catch{this.saved=!1}},async saveReply(){var s;try{const{data:t}=await f.patch(`/api/reviews/${this.reviewId}`,{reply:this.reply});this.review=(t==null?void 0:t.review)||this.review,this.reply=((s=this.review)==null?void 0:s.reply)||this.reply,this.saved=!0,setTimeout(()=>{this.saved=!1},1200)}catch{this.saved=!1}},formatDate(s){return new Date(s).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"})}}},Ue={class:"mx-auto w-full max-w-4xl space-y-6"},Se={class:"rounded-xl border border-slate-200 bg-white p-5 shadow-sm"},De={class:"mb-2 flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-slate-500"},Me={class:"mb-3 text-sm font-semibold text-slate-800"},Ae={class:"mb-3 inline-flex items-center gap-1",role:"radiogroup","aria-label":"Оценка"},Ie=["onClick","aria-label"],Pe={class:"ml-2 text-sm font-semibold text-slate-700"},Ce={class:"text-sm leading-6 text-slate-600"},Ne={class:"rounded-xl border border-slate-200 bg-white p-5 shadow-sm"},Ee={class:"mt-3 flex items-center gap-3"},Le={key:0,class:"text-sm text-emerald-700"};function Ve(s,t,o,n,l,v){const h=G("AppFrame");return m(),j(h,{active:"reviews",title:"Отзывы"},{default:z(()=>[e("div",Ue,[t[4]||(t[4]=e("div",{class:"flex flex-wrap items-start justify-between gap-3"},[e("div",null,[e("h1",{class:"text-2xl font-semibold text-slate-800"},"Детальный отзыв"),e("p",{class:"mt-1 text-sm text-slate-500"},"Источник: Яндекс Карты")]),e("a",{href:"/demo.html",class:"inline-flex h-10 items-center rounded-md border border-slate-300 px-4 text-sm font-medium text-slate-700 transition hover:bg-slate-50"}," К списку ")],-1)),e("section",Se,[e("div",De,[e("span",null,p(v.formatDate(l.review.date)),1),t[2]||(t[2]=e("span",null,"Филиал 1",-1))]),e("div",Me,p(l.review.author),1),e("div",Ae,[(m(),x(S,null,D(5,r=>e("button",{key:r,class:C(["text-2xl leading-none",r<=l.review.rating?"text-amber-400":"text-slate-300"]),type:"button",onClick:w=>v.setRating(r),"aria-label":`Оценка ${r}`}," ★ ",10,Ie)),64)),e("span",Pe,p(l.review.rating)+".0",1)]),e("p",Ce,p(l.review.text),1)]),e("section",Ne,[t[3]||(t[3]=e("div",{class:"mb-2 text-sm font-semibold text-slate-800"}," Ответ компании ",-1)),R(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=r=>l.reply=r),class:"min-h-[140px] w-full rounded-md border border-slate-300 p-3 text-sm text-slate-800 outline-none transition focus:border-sky-400 focus:ring-2 focus:ring-sky-100",placeholder:"Введите текст ответа..."},null,512),[[M,l.reply]]),e("div",Ee,[e("button",{type:"button",onClick:t[1]||(t[1]=(...r)=>v.saveReply&&v.saveReply(...r)),class:"inline-flex h-10 items-center rounded-md bg-sky-500 px-4 text-sm font-semibold text-white transition hover:bg-sky-600"}," Сохранить ответ "),l.saved?(m(),x("span",Le,"Сохранено")):_("",!0)])])])]),_:1})}const Oe=$e(Re,[["render",Ve]]),Te={class:"flex min-h-screen items-center justify-center bg-slate-100 p-4"},Fe={class:"w-full max-w-md rounded-xl border border-slate-200 bg-white p-6 shadow-sm"},je={class:"mb-6 text-sm text-slate-500"},ze={key:0,class:"flex flex-col gap-2"},Be={class:"flex flex-col gap-2"},qe={class:"flex flex-col gap-2"},We=["disabled"],He={key:1,class:"text-sm text-red-600"},Ke={class:"mt-4 text-sm text-slate-600"},Ye={key:0},Je={key:1},Ge="demo_auth",Qe={__name:"LoginPage",setup(s){const t=new URLSearchParams(window.location.search),o=g(t.get("mode")==="register"),n=g("Imtera User"),l=g("demo@imtera.ru"),v=g("demo12345"),h=g(!1),r=g(""),w=()=>{const a=new URLSearchParams(window.location.search).get("next");if(!a)return"/demo.html";try{const d=decodeURIComponent(a);return d.startsWith("/demo.html")?d:"/demo.html"}catch{return"/demo.html"}},U=async()=>{var y,a;h.value=!0,r.value="";try{const d=o.value?"/api/register":"/api/login",A=o.value?{name:n.value,email:l.value,password:v.value}:{email:l.value,password:v.value},{data:k}=await f.post(d,A);localStorage.setItem(Ge,JSON.stringify(k)),window.location.replace(w())}catch(d){r.value=((a=(y=d==null?void 0:d.response)==null?void 0:y.data)==null?void 0:a.message)||"Не удалось выполнить вход"}finally{h.value=!1}};return(y,a)=>(m(),x("div",Te,[e("div",Fe,[a[8]||(a[8]=e("h1",{class:"mb-1 text-2xl font-semibold text-slate-800"},"Вход",-1)),e("p",je,p(o.value?"Создание аккаунта":"Авторизация по логину и паролю"),1),e("form",{class:"flex flex-col gap-4",onSubmit:Q(U,["prevent"])},[o.value?(m(),x("label",ze,[a[3]||(a[3]=e("span",{class:"text-sm font-medium text-slate-700"},"Имя",-1)),R(e("input",{"onUpdate:modelValue":a[0]||(a[0]=d=>n.value=d),type:"text",autocomplete:"name",required:"",class:"h-11 rounded-md border border-slate-300 px-3 text-sm text-slate-800 outline-none transition focus:border-sky-400 focus:ring-2 focus:ring-sky-100"},null,512),[[M,n.value,void 0,{trim:!0}]])])):_("",!0),e("label",Be,[a[4]||(a[4]=e("span",{class:"text-sm font-medium text-slate-700"},"Email",-1)),R(e("input",{"onUpdate:modelValue":a[1]||(a[1]=d=>l.value=d),type:"email",autocomplete:"username",required:"",class:"h-11 rounded-md border border-slate-300 px-3 text-sm text-slate-800 outline-none transition focus:border-sky-400 focus:ring-2 focus:ring-sky-100"},null,512),[[M,l.value,void 0,{trim:!0}]])]),e("label",qe,[a[5]||(a[5]=e("span",{class:"text-sm font-medium text-slate-700"},"Пароль",-1)),R(e("input",{"onUpdate:modelValue":a[2]||(a[2]=d=>v.value=d),type:"password",autocomplete:"current-password",required:"",class:"h-11 rounded-md border border-slate-300 px-3 text-sm text-slate-800 outline-none transition focus:border-sky-400 focus:ring-2 focus:ring-sky-100"},null,512),[[M,v.value]])]),e("button",{type:"submit",disabled:h.value,class:"inline-flex h-10 items-center justify-center rounded-md bg-sky-500 px-4 text-sm font-semibold text-white transition hover:bg-sky-600 disabled:opacity-60"},p(h.value?o.value?"Создание...":"Вход...":o.value?"Зарегистрироваться":"Войти"),9,We),r.value?(m(),x("p",He,p(r.value),1)):_("",!0)],32),e("div",Ke,[o.value?(m(),x("span",Je,[...a[7]||(a[7]=[O(" Уже есть аккаунт? ",-1),e("a",{class:"text-sky-600 hover:underline",href:"/demo.html?page=login"},"Войти",-1)])])):(m(),x("span",Ye,[...a[6]||(a[6]=[O(" Нет аккаунта? ",-1),e("a",{class:"text-sky-600 hover:underline",href:"/demo.html?page=login&mode=register"},"Зарегистрироваться",-1)])]))]),a[9]||(a[9]=e("p",{class:"mt-5 rounded-md bg-slate-50 p-3 text-xs text-slate-500"}," Демо-доступ: demo@imtera.ru / demo12345 ",-1))])]))}},Xe="demo_settings",q="demo_auth";function N(){const s=localStorage.getItem(q);if(!s)return null;try{return JSON.parse(s)}catch{return null}}function Ze(){var t;const s=(t=N())==null?void 0:t.token;s?f.defaults.headers.common.Authorization=`Bearer ${s}`:delete f.defaults.headers.common.Authorization}function W(){var s;return!!((s=N())!=null&&s.token)}const E=new URLSearchParams(window.location.search);var F;E.get("logout")==="1"&&((F=N())!=null&&F.token&&f.post("/api/logout").catch(()=>{}),localStorage.removeItem(q),localStorage.removeItem(Xe));Ze();const L=E.get("page");if(L!=="login"&&!W()){const s=`${window.location.pathname}${window.location.search}`;window.location.replace(`/demo.html?page=login&next=${encodeURIComponent(s)}`)}if(L==="login"&&W()){const s=E.get("next"),t=s?decodeURIComponent(s):"/demo.html";window.location.replace(t.startsWith("/demo.html")?t:"/demo.html")}const et={login:Qe,settings:Z,review:Oe},tt=et[L]||ke,st=X(tt);st.mount("#demo-app");
