import{w as L,o as W,a as p,b as F,d as j,e,f as $,v as Y,g as v,F as S,r as D,t as u,n as P,h as R,i as B,j as g,k as b,l as A,m as J,p as M,q as G,s as V,c as Q,_ as X}from"./SettingsPage-DPXeGlVL.js";const Z={class:"grid grid-cols-1 gap-6 xl:grid-cols-[minmax(0,1fr)_280px]"},ee={class:"space-y-4"},te={class:"flex flex-wrap items-center justify-between gap-3"},se={class:"inline-flex items-center gap-2"},ae=["href"],oe={class:"mb-2 flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-slate-500"},le={class:"mb-2 text-sm font-semibold text-slate-800"},ne={class:"mb-2 inline-flex items-center gap-1"},re={class:"ml-2 text-xs font-semibold text-slate-600"},ie={class:"line-clamp-3 text-sm leading-6 text-slate-600"},de={key:0,class:"rounded-xl border border-slate-200 bg-white p-6 text-sm text-slate-500"},ce={key:1,class:"rounded-xl border border-slate-200 bg-white p-6 text-sm text-slate-500"},me={class:"flex items-center justify-between rounded-xl border border-slate-200 bg-white p-3"},ue=["disabled"],pe={class:"text-sm text-slate-500"},xe=["disabled"],ve={class:"h-fit rounded-xl border border-slate-200 bg-white p-5 shadow-sm"},ge={class:"mb-2 flex items-end gap-2"},he={class:"text-5xl font-semibold leading-none text-slate-800"},be={class:"mb-3 inline-flex items-center gap-1"},fe={class:"text-sm text-slate-500"},O=5,we={__name:"ReviewsPage",setup(s){const t=g([]),o=g("default"),n=g(1),l=g(0),x=g(0),h=g(!1),r=A(()=>Math.max(1,Math.ceil(l.value/O))),y=A(()=>t.value),U=A(()=>Number(x.value||0).toFixed(1)),w=f=>new Date(f).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"}),a=()=>{n.value<r.value&&(n.value+=1)},i=()=>{n.value>1&&(n.value-=1)},_=async()=>{var f,c,m,k;h.value=!0;try{const{data:d}=await b.get("/api/reviews",{params:{page:n.value,per_page:O,sort:o.value}});t.value=Array.isArray(d==null?void 0:d.data)?d.data:[],l.value=Number(((f=d==null?void 0:d.meta)==null?void 0:f.total)||t.value.length||0),x.value=Number(((c=d==null?void 0:d.meta)==null?void 0:c.average_rating)||0);const H=Number(((m=d==null?void 0:d.meta)==null?void 0:m.page)||n.value),K=Number(((k=d==null?void 0:d.meta)==null?void 0:k.last_page)||r.value);n.value=Math.min(H,Math.max(1,K))}catch{t.value=[],l.value=0,x.value=0}finally{h.value=!1}};return L(o,async()=>{n.value=1,await _()}),L(n,async()=>{await _()}),W(()=>{_()}),(f,c)=>(p(),F(B,{active:"reviews",title:"Отзывы"},{default:j(()=>[e("div",Z,[e("div",ee,[e("div",te,[c[3]||(c[3]=e("div",{class:"inline-flex items-center rounded-md border border-slate-200 bg-white px-3 py-1 text-xs text-slate-500"}," Яндекс Карты ",-1)),e("div",se,[c[2]||(c[2]=e("label",{class:"text-xs text-slate-500",for:"sort-order"},"Сортировка",-1)),$(e("select",{id:"sort-order","onUpdate:modelValue":c[0]||(c[0]=m=>o.value=m),class:"h-9 rounded-md border border-slate-300 bg-white px-2 text-sm text-slate-700"},[...c[1]||(c[1]=[e("option",{value:"default"},"По умолчанию",-1),e("option",{value:"newest"},"По новизне",-1),e("option",{value:"negative"},"Сначала отрицательные",-1),e("option",{value:"positive"},"Сначала положительные",-1)])],512),[[Y,o.value]])])]),(p(!0),v(S,null,D(y.value,m=>(p(),v("a",{key:m.id,href:`/demo.html?page=review&id=${m.id}`,class:"block rounded-xl border border-slate-200 bg-white p-4 shadow-sm transition hover:border-sky-300"},[e("div",oe,[e("span",null,u(w(m.date)),1),c[4]||(c[4]=e("span",null,"Филиал 1",-1))]),e("div",le,u(m.author),1),e("div",ne,[(p(),v(S,null,D(5,k=>e("span",{key:k,class:P(["text-sm",k<=m.rating?"text-amber-400":"text-slate-300"])},"★",2)),64)),e("span",re,u(m.rating)+".0",1)]),e("p",ie,u(m.text),1)],8,ae))),128)),!h.value&&y.value.length===0?(p(),v("div",de," Отзывы не найдены. Выполните импорт из Яндекс.Карт на странице настроек. ")):R("",!0),h.value?(p(),v("div",ce," Загрузка отзывов... ")):R("",!0),e("div",me,[e("button",{type:"button",class:"rounded-md border border-slate-300 px-3 py-1 text-sm text-slate-700 disabled:opacity-50",disabled:n.value===1,onClick:i}," Назад ",8,ue),e("div",pe," Страница "+u(n.value)+" из "+u(r.value),1),e("button",{type:"button",class:"rounded-md border border-slate-300 px-3 py-1 text-sm text-slate-700 disabled:opacity-50",disabled:n.value===r.value,onClick:a}," Вперёд ",8,xe)])]),e("aside",ve,[e("div",ge,[e("span",he,u(U.value),1),c[5]||(c[5]=e("span",{class:"pb-1 text-sm text-slate-500"},"из 5",-1))]),e("div",be,[(p(),v(S,null,D(5,m=>e("span",{key:`avg-${m}`,class:P(["text-xl",m<=Math.round(U.value)?"text-amber-400":"text-slate-300"])},"★",2)),64))]),e("div",fe," Всего отзывов: "+u(l.value),1)])])]),_:1}))}},ye=(s,t)=>{const o=s.__vccOpts||s;for(const[n,l]of t)o[n]=l;return o},I={id:1,author:"—",rating:0,date:new Date().toISOString().slice(0,10),text:"",reply:""},_e={components:{AppFrame:B},data(){return{reply:"",saved:!1,review:I,reviewId:1}},async mounted(){const s=new URLSearchParams(window.location.search),t=Number(s.get("id")||1);this.reviewId=t;try{const{data:o}=await b.get(`/api/reviews/${t}`);this.review=o||I,this.reply=(o==null?void 0:o.reply)||""}catch{this.review=I,this.reply=""}},methods:{async setRating(s){try{const{data:t}=await b.patch(`/api/reviews/${this.reviewId}`,{rating:s});this.review=(t==null?void 0:t.review)||this.review,this.saved=!0,setTimeout(()=>{this.saved=!1},900)}catch{this.saved=!1}},async saveReply(){var s;try{const{data:t}=await b.patch(`/api/reviews/${this.reviewId}`,{reply:this.reply});this.review=(t==null?void 0:t.review)||this.review,this.reply=((s=this.review)==null?void 0:s.reply)||this.reply,this.saved=!0,setTimeout(()=>{this.saved=!1},1200)}catch{this.saved=!1}},formatDate(s){return new Date(s).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"})}}},ke={class:"mx-auto w-full max-w-4xl space-y-6"},$e={class:"rounded-xl border border-slate-200 bg-white p-5 shadow-sm"},Re={class:"mb-2 flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-slate-500"},Ue={class:"mb-3 text-sm font-semibold text-slate-800"},Se={class:"mb-3 inline-flex items-center gap-1",role:"radiogroup","aria-label":"Оценка"},De=["onClick","aria-label"],Me={class:"ml-2 text-sm font-semibold text-slate-700"},Ae={class:"text-sm leading-6 text-slate-600"},Ie={class:"rounded-xl border border-slate-200 bg-white p-5 shadow-sm"},Pe={class:"mt-3 flex items-center gap-3"},Ce={key:0,class:"text-sm text-emerald-700"};function Ne(s,t,o,n,l,x){const h=J("AppFrame");return p(),F(h,{active:"reviews",title:"Отзывы"},{default:j(()=>[e("div",ke,[t[4]||(t[4]=e("div",{class:"flex flex-wrap items-start justify-between gap-3"},[e("div",null,[e("h1",{class:"text-2xl font-semibold text-slate-800"},"Детальный отзыв"),e("p",{class:"mt-1 text-sm text-slate-500"},"Источник: Яндекс Карты")]),e("a",{href:"/demo.html",class:"inline-flex h-10 items-center rounded-md border border-slate-300 px-4 text-sm font-medium text-slate-700 transition hover:bg-slate-50"}," К списку ")],-1)),e("section",$e,[e("div",Re,[e("span",null,u(x.formatDate(l.review.date)),1),t[2]||(t[2]=e("span",null,"Филиал 1",-1))]),e("div",Ue,u(l.review.author),1),e("div",Se,[(p(),v(S,null,D(5,r=>e("button",{key:r,class:P(["text-2xl leading-none",r<=l.review.rating?"text-amber-400":"text-slate-300"]),type:"button",onClick:y=>x.setRating(r),"aria-label":`Оценка ${r}`}," ★ ",10,De)),64)),e("span",Me,u(l.review.rating)+".0",1)]),e("p",Ae,u(l.review.text),1)]),e("section",Ie,[t[3]||(t[3]=e("div",{class:"mb-2 text-sm font-semibold text-slate-800"}," Ответ компании ",-1)),$(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=r=>l.reply=r),class:"min-h-[140px] w-full rounded-md border border-slate-300 p-3 text-sm text-slate-800 outline-none transition focus:border-sky-400 focus:ring-2 focus:ring-sky-100",placeholder:"Введите текст ответа..."},null,512),[[M,l.reply]]),e("div",Pe,[e("button",{type:"button",onClick:t[1]||(t[1]=(...r)=>x.saveReply&&x.saveReply(...r)),class:"inline-flex h-10 items-center rounded-md bg-sky-500 px-4 text-sm font-semibold text-white transition hover:bg-sky-600"}," Сохранить ответ "),l.saved?(p(),v("span",Ce,"Сохранено")):R("",!0)])])])]),_:1})}const Ee=ye(_e,[["render",Ne]]),Le={class:"flex min-h-screen items-center justify-center bg-slate-100 p-4"},Ve={class:"w-full max-w-md rounded-xl border border-slate-200 bg-white p-6 shadow-sm"},Oe={class:"mb-6 text-sm text-slate-500"},Te={key:0,class:"flex flex-col gap-2"},Fe={class:"flex flex-col gap-2"},je={class:"flex flex-col gap-2"},Be=["disabled"],ze={key:1,class:"text-sm text-red-600"},qe={class:"mt-4 text-sm text-slate-600"},He={key:0},Ke={key:1},We="demo_auth",Ye={__name:"LoginPage",setup(s){const t=new URLSearchParams(window.location.search),o=g(t.get("mode")==="register"),n=g("Imtera User"),l=g("demo@imtera.ru"),x=g("demo12345"),h=g(!1),r=g(""),y=()=>{const a=new URLSearchParams(window.location.search).get("next");if(!a)return"/demo.html";try{const i=decodeURIComponent(a);return i.startsWith("/demo.html")?i:"/demo.html"}catch{return"/demo.html"}},U=async()=>{var w,a;h.value=!0,r.value="";try{const i=o.value?"/api/register":"/api/login",_=o.value?{name:n.value,email:l.value,password:x.value}:{email:l.value,password:x.value},{data:f}=await b.post(i,_);localStorage.setItem(We,JSON.stringify(f)),window.location.replace(y())}catch(i){r.value=((a=(w=i==null?void 0:i.response)==null?void 0:w.data)==null?void 0:a.message)||"Не удалось выполнить вход"}finally{h.value=!1}};return(w,a)=>(p(),v("div",Le,[e("div",Ve,[a[8]||(a[8]=e("h1",{class:"mb-1 text-2xl font-semibold text-slate-800"},"Вход",-1)),e("p",Oe,u(o.value?"Создание аккаунта":"Авторизация по логину и паролю"),1),e("form",{class:"flex flex-col gap-4",onSubmit:G(U,["prevent"])},[o.value?(p(),v("label",Te,[a[3]||(a[3]=e("span",{class:"text-sm font-medium text-slate-700"},"Имя",-1)),$(e("input",{"onUpdate:modelValue":a[0]||(a[0]=i=>n.value=i),type:"text",autocomplete:"name",required:"",class:"h-11 rounded-md border border-slate-300 px-3 text-sm text-slate-800 outline-none transition focus:border-sky-400 focus:ring-2 focus:ring-sky-100"},null,512),[[M,n.value,void 0,{trim:!0}]])])):R("",!0),e("label",Fe,[a[4]||(a[4]=e("span",{class:"text-sm font-medium text-slate-700"},"Email",-1)),$(e("input",{"onUpdate:modelValue":a[1]||(a[1]=i=>l.value=i),type:"email",autocomplete:"username",required:"",class:"h-11 rounded-md border border-slate-300 px-3 text-sm text-slate-800 outline-none transition focus:border-sky-400 focus:ring-2 focus:ring-sky-100"},null,512),[[M,l.value,void 0,{trim:!0}]])]),e("label",je,[a[5]||(a[5]=e("span",{class:"text-sm font-medium text-slate-700"},"Пароль",-1)),$(e("input",{"onUpdate:modelValue":a[2]||(a[2]=i=>x.value=i),type:"password",autocomplete:"current-password",required:"",class:"h-11 rounded-md border border-slate-300 px-3 text-sm text-slate-800 outline-none transition focus:border-sky-400 focus:ring-2 focus:ring-sky-100"},null,512),[[M,x.value]])]),e("button",{type:"submit",disabled:h.value,class:"inline-flex h-10 items-center justify-center rounded-md bg-sky-500 px-4 text-sm font-semibold text-white transition hover:bg-sky-600 disabled:opacity-60"},u(h.value?o.value?"Создание...":"Вход...":o.value?"Зарегистрироваться":"Войти"),9,Be),r.value?(p(),v("p",ze,u(r.value),1)):R("",!0)],32),e("div",qe,[o.value?(p(),v("span",Ke,[...a[7]||(a[7]=[V(" Уже есть аккаунт? ",-1),e("a",{class:"text-sky-600 hover:underline",href:"/demo.html?page=login"},"Войти",-1)])])):(p(),v("span",He,[...a[6]||(a[6]=[V(" Нет аккаунта? ",-1),e("a",{class:"text-sky-600 hover:underline",href:"/demo.html?page=login&mode=register"},"Зарегистрироваться",-1)])]))]),a[9]||(a[9]=e("p",{class:"mt-5 rounded-md bg-slate-50 p-3 text-xs text-slate-500"}," Демо-доступ: demo@imtera.ru / demo12345 ",-1))])]))}},Je="demo_settings",z="demo_auth";function C(){const s=localStorage.getItem(z);if(!s)return null;try{return JSON.parse(s)}catch{return null}}function Ge(){var t;const s=(t=C())==null?void 0:t.token;s?b.defaults.headers.common.Authorization=`Bearer ${s}`:delete b.defaults.headers.common.Authorization}function q(){var s;return!!((s=C())!=null&&s.token)}const N=new URLSearchParams(window.location.search);var T;N.get("logout")==="1"&&((T=C())!=null&&T.token&&b.post("/api/logout").catch(()=>{}),localStorage.removeItem(z),localStorage.removeItem(Je));Ge();const E=N.get("page");if(E!=="login"&&!q()){const s=`${window.location.pathname}${window.location.search}`;window.location.replace(`/demo.html?page=login&next=${encodeURIComponent(s)}`)}if(E==="login"&&q()){const s=N.get("next"),t=s?decodeURIComponent(s):"/demo.html";window.location.replace(t.startsWith("/demo.html")?t:"/demo.html")}const Qe={login:Ye,settings:X,review:Ee},Xe=Qe[E]||we,Ze=Q(Xe);Ze.mount("#demo-app");
