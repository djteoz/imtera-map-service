import{w as P,o as H,a as p,b as E,d as N,e,f as k,v as K,g as v,F as _,r as y,t as u,n as D,h as $,i as L,j as g,k as b,l as S,m as W,p as A,q as Y,c as J,_ as G}from"./SettingsPage-DVrPnzvV.js";const Q={class:"grid grid-cols-1 gap-6 xl:grid-cols-[minmax(0,1fr)_280px]"},X={class:"space-y-4"},Z={class:"flex flex-wrap items-center justify-between gap-3"},ee={class:"inline-flex items-center gap-2"},te=["href"],se={class:"mb-2 flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-slate-500"},ae={class:"mb-2 text-sm font-semibold text-slate-800"},oe={class:"mb-2 inline-flex items-center gap-1"},le={class:"ml-2 text-xs font-semibold text-slate-600"},ne={class:"line-clamp-3 text-sm leading-6 text-slate-600"},re={key:0,class:"rounded-xl border border-slate-200 bg-white p-6 text-sm text-slate-500"},ie={key:1,class:"rounded-xl border border-slate-200 bg-white p-6 text-sm text-slate-500"},de={class:"flex items-center justify-between rounded-xl border border-slate-200 bg-white p-3"},ce=["disabled"],me={class:"text-sm text-slate-500"},ue=["disabled"],pe={class:"h-fit rounded-xl border border-slate-200 bg-white p-5 shadow-sm"},xe={class:"mb-2 flex items-end gap-2"},ve={class:"text-5xl font-semibold leading-none text-slate-800"},ge={class:"mb-3 inline-flex items-center gap-1"},he={class:"text-sm text-slate-500"},C=5,be={__name:"ReviewsPage",setup(s){const t=g([]),r=g("newest"),o=g(1),l=g(0),x=g(0),h=g(!1),n=S(()=>Math.max(1,Math.ceil(l.value/C))),a=S(()=>t.value),d=S(()=>Number(x.value||0).toFixed(1)),V=f=>new Date(f).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"}),j=()=>{o.value<n.value&&(o.value+=1)},B=()=>{o.value>1&&(o.value-=1)},R=async()=>{var f,c,m,w;h.value=!0;try{const{data:i}=await b.get("/api/reviews",{params:{page:o.value,per_page:C,sort:r.value}});t.value=Array.isArray(i==null?void 0:i.data)?i.data:[],l.value=Number(((f=i==null?void 0:i.meta)==null?void 0:f.total)||t.value.length||0),x.value=Number(((c=i==null?void 0:i.meta)==null?void 0:c.average_rating)||0);const z=Number(((m=i==null?void 0:i.meta)==null?void 0:m.page)||o.value),q=Number(((w=i==null?void 0:i.meta)==null?void 0:w.last_page)||n.value);o.value=Math.min(z,Math.max(1,q))}catch{t.value=[],l.value=0,x.value=0}finally{h.value=!1}};return P(r,async()=>{o.value=1,await R()}),P(o,async()=>{await R()}),H(()=>{R()}),(f,c)=>(p(),E(L,{active:"reviews",title:"Отзывы"},{default:N(()=>[e("div",Q,[e("div",X,[e("div",Z,[c[3]||(c[3]=e("div",{class:"inline-flex items-center rounded-md border border-slate-200 bg-white px-3 py-1 text-xs text-slate-500"}," Яндекс Карты ",-1)),e("div",ee,[c[2]||(c[2]=e("label",{class:"text-xs text-slate-500",for:"sort-order"},"Сортировка",-1)),k(e("select",{id:"sort-order","onUpdate:modelValue":c[0]||(c[0]=m=>r.value=m),class:"h-9 rounded-md border border-slate-300 bg-white px-2 text-sm text-slate-700"},[...c[1]||(c[1]=[e("option",{value:"newest"},"Сначала новые",-1),e("option",{value:"oldest"},"Сначала старые",-1)])],512),[[K,r.value]])])]),(p(!0),v(_,null,y(a.value,m=>(p(),v("a",{key:m.id,href:`/demo.html?page=review&id=${m.id}`,class:"block rounded-xl border border-slate-200 bg-white p-4 shadow-sm transition hover:border-sky-300"},[e("div",se,[e("span",null,u(V(m.date)),1),c[4]||(c[4]=e("span",null,"Филиал 1",-1))]),e("div",ae,u(m.author),1),e("div",oe,[(p(),v(_,null,y(5,w=>e("span",{key:w,class:D(["text-sm",w<=m.rating?"text-amber-400":"text-slate-300"])},"★",2)),64)),e("span",le,u(m.rating)+".0",1)]),e("p",ne,u(m.text),1)],8,te))),128)),!h.value&&a.value.length===0?(p(),v("div",re," Отзывы не найдены. Выполните импорт из Яндекс.Карт на странице настроек. ")):$("",!0),h.value?(p(),v("div",ie," Загрузка отзывов... ")):$("",!0),e("div",de,[e("button",{type:"button",class:"rounded-md border border-slate-300 px-3 py-1 text-sm text-slate-700 disabled:opacity-50",disabled:o.value===1,onClick:B}," Назад ",8,ce),e("div",me," Страница "+u(o.value)+" из "+u(n.value),1),e("button",{type:"button",class:"rounded-md border border-slate-300 px-3 py-1 text-sm text-slate-700 disabled:opacity-50",disabled:o.value===n.value,onClick:j}," Вперёд ",8,ue)])]),e("aside",pe,[e("div",xe,[e("span",ve,u(d.value),1),c[5]||(c[5]=e("span",{class:"pb-1 text-sm text-slate-500"},"из 5",-1))]),e("div",ge,[(p(),v(_,null,y(5,m=>e("span",{key:`avg-${m}`,class:D(["text-xl",m<=Math.round(d.value)?"text-amber-400":"text-slate-300"])},"★",2)),64))]),e("div",he," Всего отзывов: "+u(l.value),1)])])]),_:1}))}},fe=(s,t)=>{const r=s.__vccOpts||s;for(const[o,l]of t)r[o]=l;return r},U={id:1,author:"—",rating:0,date:new Date().toISOString().slice(0,10),text:"",reply:""},we={components:{AppFrame:L},data(){return{reply:"",saved:!1,review:U,reviewId:1}},async mounted(){const s=new URLSearchParams(window.location.search),t=Number(s.get("id")||1);this.reviewId=t;try{const{data:r}=await b.get(`/api/reviews/${t}`);this.review=r||U,this.reply=(r==null?void 0:r.reply)||""}catch{this.review=U,this.reply=""}},methods:{async setRating(s){try{const{data:t}=await b.patch(`/api/reviews/${this.reviewId}`,{rating:s});this.review=(t==null?void 0:t.review)||this.review,this.saved=!0,setTimeout(()=>{this.saved=!1},900)}catch{this.saved=!1}},async saveReply(){var s;try{const{data:t}=await b.patch(`/api/reviews/${this.reviewId}`,{reply:this.reply});this.review=(t==null?void 0:t.review)||this.review,this.reply=((s=this.review)==null?void 0:s.reply)||this.reply,this.saved=!0,setTimeout(()=>{this.saved=!1},1200)}catch{this.saved=!1}},formatDate(s){return new Date(s).toLocaleDateString("ru-RU",{day:"2-digit",month:"2-digit",year:"numeric"})}}},_e={class:"mx-auto w-full max-w-4xl space-y-6"},ye={class:"rounded-xl border border-slate-200 bg-white p-5 shadow-sm"},ke={class:"mb-2 flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-slate-500"},$e={class:"mb-3 text-sm font-semibold text-slate-800"},Re={class:"mb-3 inline-flex items-center gap-1",role:"radiogroup","aria-label":"Оценка"},Se=["onClick","aria-label"],Ue={class:"ml-2 text-sm font-semibold text-slate-700"},De={class:"text-sm leading-6 text-slate-600"},Ae={class:"rounded-xl border border-slate-200 bg-white p-5 shadow-sm"},Me={class:"mt-3 flex items-center gap-3"},Ie={key:0,class:"text-sm text-emerald-700"};function Pe(s,t,r,o,l,x){const h=W("AppFrame");return p(),E(h,{active:"reviews",title:"Отзывы"},{default:N(()=>[e("div",_e,[t[4]||(t[4]=e("div",{class:"flex flex-wrap items-start justify-between gap-3"},[e("div",null,[e("h1",{class:"text-2xl font-semibold text-slate-800"},"Детальный отзыв"),e("p",{class:"mt-1 text-sm text-slate-500"},"Источник: Яндекс Карты")]),e("a",{href:"/demo.html",class:"inline-flex h-10 items-center rounded-md border border-slate-300 px-4 text-sm font-medium text-slate-700 transition hover:bg-slate-50"}," К списку ")],-1)),e("section",ye,[e("div",ke,[e("span",null,u(x.formatDate(l.review.date)),1),t[2]||(t[2]=e("span",null,"Филиал 1",-1))]),e("div",$e,u(l.review.author),1),e("div",Re,[(p(),v(_,null,y(5,n=>e("button",{key:n,class:D(["text-2xl leading-none",n<=l.review.rating?"text-amber-400":"text-slate-300"]),type:"button",onClick:a=>x.setRating(n),"aria-label":`Оценка ${n}`}," ★ ",10,Se)),64)),e("span",Ue,u(l.review.rating)+".0",1)]),e("p",De,u(l.review.text),1)]),e("section",Ae,[t[3]||(t[3]=e("div",{class:"mb-2 text-sm font-semibold text-slate-800"}," Ответ компании ",-1)),k(e("textarea",{"onUpdate:modelValue":t[0]||(t[0]=n=>l.reply=n),class:"min-h-[140px] w-full rounded-md border border-slate-300 p-3 text-sm text-slate-800 outline-none transition focus:border-sky-400 focus:ring-2 focus:ring-sky-100",placeholder:"Введите текст ответа..."},null,512),[[A,l.reply]]),e("div",Me,[e("button",{type:"button",onClick:t[1]||(t[1]=(...n)=>x.saveReply&&x.saveReply(...n)),class:"inline-flex h-10 items-center rounded-md bg-sky-500 px-4 text-sm font-semibold text-white transition hover:bg-sky-600"}," Сохранить ответ "),l.saved?(p(),v("span",Ie,"Сохранено")):$("",!0)])])])]),_:1})}const Ce=fe(we,[["render",Pe]]),Ee={class:"flex min-h-screen items-center justify-center bg-slate-100 p-4"},Ne={class:"w-full max-w-md rounded-xl border border-slate-200 bg-white p-6 shadow-sm"},Le={class:"flex flex-col gap-2"},Oe={class:"flex flex-col gap-2"},Fe=["disabled"],Te={key:0,class:"text-sm text-red-600"},Ve="demo_auth",je={__name:"LoginPage",setup(s){const t=g("demo@imtera.ru"),r=g("demo12345"),o=g(!1),l=g(""),x=()=>{const a=new URLSearchParams(window.location.search).get("next");if(!a)return"/demo.html";try{const d=decodeURIComponent(a);return d.startsWith("/demo.html")?d:"/demo.html"}catch{return"/demo.html"}},h=async()=>{var n,a;o.value=!0,l.value="";try{const{data:d}=await b.post("/api/login",{email:t.value,password:r.value});localStorage.setItem(Ve,JSON.stringify(d)),window.location.replace(x())}catch(d){l.value=((a=(n=d==null?void 0:d.response)==null?void 0:n.data)==null?void 0:a.message)||"Не удалось выполнить вход"}finally{o.value=!1}};return(n,a)=>(p(),v("div",Ee,[e("div",Ne,[a[4]||(a[4]=e("h1",{class:"mb-1 text-2xl font-semibold text-slate-800"},"Вход",-1)),a[5]||(a[5]=e("p",{class:"mb-6 text-sm text-slate-500"},"Авторизация по логину и паролю",-1)),e("form",{class:"flex flex-col gap-4",onSubmit:Y(h,["prevent"])},[e("label",Le,[a[2]||(a[2]=e("span",{class:"text-sm font-medium text-slate-700"},"Email",-1)),k(e("input",{"onUpdate:modelValue":a[0]||(a[0]=d=>t.value=d),type:"email",autocomplete:"username",required:"",class:"h-11 rounded-md border border-slate-300 px-3 text-sm text-slate-800 outline-none transition focus:border-sky-400 focus:ring-2 focus:ring-sky-100"},null,512),[[A,t.value,void 0,{trim:!0}]])]),e("label",Oe,[a[3]||(a[3]=e("span",{class:"text-sm font-medium text-slate-700"},"Пароль",-1)),k(e("input",{"onUpdate:modelValue":a[1]||(a[1]=d=>r.value=d),type:"password",autocomplete:"current-password",required:"",class:"h-11 rounded-md border border-slate-300 px-3 text-sm text-slate-800 outline-none transition focus:border-sky-400 focus:ring-2 focus:ring-sky-100"},null,512),[[A,r.value]])]),e("button",{type:"submit",disabled:o.value,class:"inline-flex h-10 items-center justify-center rounded-md bg-sky-500 px-4 text-sm font-semibold text-white transition hover:bg-sky-600 disabled:opacity-60"},u(o.value?"Вход...":"Войти"),9,Fe),l.value?(p(),v("p",Te,u(l.value),1)):$("",!0)],32),a[6]||(a[6]=e("p",{class:"mt-5 rounded-md bg-slate-50 p-3 text-xs text-slate-500"}," Демо-доступ: demo@imtera.ru / demo12345 ",-1))])]))}},Be="demo_settings",O="demo_auth";function F(){const s=localStorage.getItem(O);if(!s)return null;try{return JSON.parse(s)}catch{return null}}function ze(){var t;const s=(t=F())==null?void 0:t.token;s?b.defaults.headers.common.Authorization=`Bearer ${s}`:delete b.defaults.headers.common.Authorization}function T(){var s;return!!((s=F())!=null&&s.token)}const M=new URLSearchParams(window.location.search);M.get("logout")==="1"&&(localStorage.removeItem(O),localStorage.removeItem(Be));ze();const I=M.get("page");if(I!=="login"&&!T()){const s=`${window.location.pathname}${window.location.search}`;window.location.replace(`/demo.html?page=login&next=${encodeURIComponent(s)}`)}if(I==="login"&&T()){const s=M.get("next"),t=s?decodeURIComponent(s):"/demo.html";window.location.replace(t.startsWith("/demo.html")?t:"/demo.html")}const qe={login:je,settings:G,review:Ce},He=qe[I]||be,Ke=J(He);Ke.mount("#demo-app");
